<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tautology</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uzip@0.20201231.0/UZIP.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="./text_thermal.js"></script>
</head>
<body>
    <div id="app">
        <h1>TTLG</h1>
        <textarea v-model="asciiData" @input="updateHexData"></textarea>
        <textarea v-model="hexData" @input="updateAsciiData"></textarea>
    </div>
    <script>
        // Function to fetch the image and get pixel values
        async function fetchImageAndExtractPixels(imageUrl) {
            // Fetch the image
            const response = await fetch(imageUrl);
            const blob = await response.blob();

            // Create an HTMLImageElement
            const img = document.createElement('img');
            const objectUrl = URL.createObjectURL(blob);
            img.src = objectUrl;

            // Wait for the image to load
            await new Promise((resolve) => {
                img.onload = resolve;
            });

            // Create a canvas element
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            // Set canvas dimensions to match image dimensions
            canvas.width = img.width;
            canvas.height = img.height;

            // Draw the image onto the canvas
            ctx.drawImage(img, 0, 0);

            // Get the pixel values as Uint8Array
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const pixels = new Uint8Array(imageData.data.buffer);

            // Clean up object URL
            URL.revokeObjectURL(objectUrl);

            // Return the pixel values
            return pixels;
        }

        // Usage example
        // const imageUrl = 'Pair_of_mandarin_ducks.jpg';
        // fetchImageAndExtractPixels(imageUrl)
        //     .then((pixels) => {
        //         const deflated = UZIP.deflateRaw(pixels, {level:9});
        //         const detail = inflate_detail(deflated);
        //         console.log(detail);
        //     })
        //     .catch((error) => {
        //         console.error(error);
        //     });
        // // Define the string to convert
        // // const str = "Hello, worldorlorlorlorl!34 451w 8 744w4102矮矮矮矮矮矮 orlorlorl452s7ef 挖orlorlorlorl 我就就 orlorl那你是矮矮7 是   经  出哦可 可你不 和";
        const str = `12345678924187967432017594852984152018941598520498602498718413174981074710180974891607418091074`;
        const encoder = new TextEncoder();
        const encodedArray = encoder.encode(str, {});
        const deflated = UZIP.deflateRaw(encodedArray, {level:9});
        const detail = inflate_detail(deflated);
        console.log(detail);

        const decoder = new TextDecoder();
        const decodedString = decoder.decode(detail.buf);
        console.log(decodedString);
    </script>
</body>
</html>